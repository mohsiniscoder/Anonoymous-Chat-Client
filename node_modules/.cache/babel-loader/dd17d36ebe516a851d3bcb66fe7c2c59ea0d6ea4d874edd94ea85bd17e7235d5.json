{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WebSocket = void 0;\nconst transport_1 = require(\"../transport\");\nconst debug_1 = require(\"debug\");\nconst debug = (0, debug_1.default)(\"engine:ws\");\nclass WebSocket extends transport_1.Transport {\n  /**\n   * WebSocket transport\n   *\n   * @param {EngineRequest} req\n   */\n  constructor(req) {\n    super(req);\n    this._doSend = data => {\n      this.socket.send(data, this._onSent);\n    };\n    this._doSendLast = data => {\n      this.socket.send(data, this._onSentLast);\n    };\n    this._onSent = err => {\n      if (err) {\n        this.onError(\"write error\", err.stack);\n      }\n    };\n    this._onSentLast = err => {\n      if (err) {\n        this.onError(\"write error\", err.stack);\n      } else {\n        this.emit(\"drain\");\n        this.writable = true;\n        this.emit(\"ready\");\n      }\n    };\n    this.socket = req.websocket;\n    this.socket.on(\"message\", (data, isBinary) => {\n      const message = isBinary ? data : data.toString();\n      debug('received \"%s\"', message);\n      super.onData(message);\n    });\n    this.socket.once(\"close\", this.onClose.bind(this));\n    this.socket.on(\"error\", this.onError.bind(this));\n    this.writable = true;\n    this.perMessageDeflate = null;\n  }\n  /**\n   * Transport name\n   */\n  get name() {\n    return \"websocket\";\n  }\n  /**\n   * Advertise upgrade support.\n   */\n  get handlesUpgrades() {\n    return true;\n  }\n  send(packets) {\n    this.writable = false;\n    for (let i = 0; i < packets.length; i++) {\n      const packet = packets[i];\n      const isLast = i + 1 === packets.length;\n      if (this._canSendPreEncodedFrame(packet)) {\n        // the WebSocket frame was computed with WebSocket.Sender.frame()\n        // see https://github.com/websockets/ws/issues/617#issuecomment-283002469\n        this.socket._sender.sendFrame(\n        // @ts-ignore\n        packet.options.wsPreEncodedFrame, isLast ? this._onSentLast : this._onSent);\n      } else {\n        this.parser.encodePacket(packet, this.supportsBinary, isLast ? this._doSendLast : this._doSend);\n      }\n    }\n  }\n  /**\n   * Whether the encoding of the WebSocket frame can be skipped.\n   * @param packet\n   * @private\n   */\n  _canSendPreEncodedFrame(packet) {\n    var _a, _b, _c;\n    return !this.perMessageDeflate && typeof ((_b = (_a = this.socket) === null || _a === void 0 ? void 0 : _a._sender) === null || _b === void 0 ? void 0 : _b.sendFrame) === \"function\" &&\n    // @ts-ignore\n    ((_c = packet.options) === null || _c === void 0 ? void 0 : _c.wsPreEncodedFrame) !== undefined;\n  }\n  doClose(fn) {\n    debug(\"closing\");\n    this.socket.close();\n    fn && fn();\n  }\n}\nexports.WebSocket = WebSocket;","map":{"version":3,"names":["Object","defineProperty","exports","value","WebSocket","transport_1","require","debug_1","debug","default","Transport","constructor","req","_doSend","data","socket","send","_onSent","_doSendLast","_onSentLast","err","onError","stack","emit","writable","websocket","on","isBinary","message","toString","onData","once","onClose","bind","perMessageDeflate","name","handlesUpgrades","packets","i","length","packet","isLast","_canSendPreEncodedFrame","_sender","sendFrame","options","wsPreEncodedFrame","parser","encodePacket","supportsBinary","_a","_b","_c","undefined","doClose","fn","close"],"sources":["D:/Anonymous chat app/anonymous-chat/node_modules/engine.io/build/transports/websocket.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocket = void 0;\nconst transport_1 = require(\"../transport\");\nconst debug_1 = require(\"debug\");\nconst debug = (0, debug_1.default)(\"engine:ws\");\nclass WebSocket extends transport_1.Transport {\n    /**\n     * WebSocket transport\n     *\n     * @param {EngineRequest} req\n     */\n    constructor(req) {\n        super(req);\n        this._doSend = (data) => {\n            this.socket.send(data, this._onSent);\n        };\n        this._doSendLast = (data) => {\n            this.socket.send(data, this._onSentLast);\n        };\n        this._onSent = (err) => {\n            if (err) {\n                this.onError(\"write error\", err.stack);\n            }\n        };\n        this._onSentLast = (err) => {\n            if (err) {\n                this.onError(\"write error\", err.stack);\n            }\n            else {\n                this.emit(\"drain\");\n                this.writable = true;\n                this.emit(\"ready\");\n            }\n        };\n        this.socket = req.websocket;\n        this.socket.on(\"message\", (data, isBinary) => {\n            const message = isBinary ? data : data.toString();\n            debug('received \"%s\"', message);\n            super.onData(message);\n        });\n        this.socket.once(\"close\", this.onClose.bind(this));\n        this.socket.on(\"error\", this.onError.bind(this));\n        this.writable = true;\n        this.perMessageDeflate = null;\n    }\n    /**\n     * Transport name\n     */\n    get name() {\n        return \"websocket\";\n    }\n    /**\n     * Advertise upgrade support.\n     */\n    get handlesUpgrades() {\n        return true;\n    }\n    send(packets) {\n        this.writable = false;\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const isLast = i + 1 === packets.length;\n            if (this._canSendPreEncodedFrame(packet)) {\n                // the WebSocket frame was computed with WebSocket.Sender.frame()\n                // see https://github.com/websockets/ws/issues/617#issuecomment-283002469\n                this.socket._sender.sendFrame(\n                // @ts-ignore\n                packet.options.wsPreEncodedFrame, isLast ? this._onSentLast : this._onSent);\n            }\n            else {\n                this.parser.encodePacket(packet, this.supportsBinary, isLast ? this._doSendLast : this._doSend);\n            }\n        }\n    }\n    /**\n     * Whether the encoding of the WebSocket frame can be skipped.\n     * @param packet\n     * @private\n     */\n    _canSendPreEncodedFrame(packet) {\n        var _a, _b, _c;\n        return (!this.perMessageDeflate &&\n            typeof ((_b = (_a = this.socket) === null || _a === void 0 ? void 0 : _a._sender) === null || _b === void 0 ? void 0 : _b.sendFrame) === \"function\" &&\n            // @ts-ignore\n            ((_c = packet.options) === null || _c === void 0 ? void 0 : _c.wsPreEncodedFrame) !== undefined);\n    }\n    doClose(fn) {\n        debug(\"closing\");\n        this.socket.close();\n        fn && fn();\n    }\n}\nexports.WebSocket = WebSocket;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}